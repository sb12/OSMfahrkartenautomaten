<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title></title>
		<link rel="stylesheet" type="text/css" href="http://necolas.github.io/normalize.css/2.1.3/normalize.css" />
		<style type="text/css">
			body {width: 600px; margin: auto;}
		</style>
	</head>
	<body>
		<h1>Fahrkartenautomatenauswertung Deutsche Bahn</h1>
		<p>Es gibt wohl <a href="http://www.db-vertrieb.com/db_vertrieb/view/leistungen/vertriebskanaele/automat.shtml">ca. 7000 Automaten der Deutschen Bahn</a></p>
		<p>Hier eine Auswertung aller Automaten der Deutschen Bahn über die OverpassAPI. Gezählt werden alle Fahrkartenautomaten mit operator="Deutsche Bahn", "Deutsche Bahn AG","DB","DB AG", "DB Bahn", "DBAG", "DB Regio AG", "DB Regio", "DB Station&Service", "DB Station&Service AG", "Deutsche Bahn (DB)", "DB Vertrieb" und "DB Vertrieb GmbH".</p>
		<p><a href="./">Die Karte mit den Automaten gibts hier</a></p>
		<h2>Auswertung</h2>
		<div id="auswertung">
			Abfrage läuft...
		</div>
	</body>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script>

		function auswertung(anzahl){
			$('#auswertung').html("Zur Zeit sind "+anzahl + " von ca. 7000 Automaten der Deutschen Bahn erfasst.");
		}

		function parseOSM(data){
			counter = 0;
			DB_operator = ['deutsche bahn', 'deutsche bahn ag', 'db', 'db ag', 'db bahn', 'dbag', 'db regio ag', 'db regio', 'db station&service', 'db station & service', 'db station&service ag', 'deutsche bahn (db)', 'db vertrieb', 'db vertrieb gmbh'];

			$(data).find('node').each(function(){
				$(this).find('tag').each(function(){
					if($(this).attr("k")=="operator")
						
						var lowerOperator = $(this).attr("v").toLowerCase();
						if (DB_operator.indexOf(lowerOperator)>-1) counter++;
						
				});
			});
			auswertung(counter);
		}



		XMLRequestText = '( node ["vending"="public_transport_tickets"] ( 47.0,5.0,55.0,15.5 ); >; ); out;';
					
					
		//URL Codieren
		XMLRequestText = encodeURIComponent(XMLRequestText);
		
		RequestURL = "http://overpass-api.de/api/interpreter?data=" + XMLRequestText;
		//AJAX REQUEST
		
		
		$.ajax({
		url: RequestURL,
		type: 'GET',
		crossDomain: true,
		success: function(data){parseOSM(data);}
		//beforeSend: setHeader
		});	
	</script>
</html>